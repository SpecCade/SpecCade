{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://speccade.dev/schemas/spec-v1.json",
  "title": "SpecCade Spec v1",
  "description": "Editor-oriented JSON Schema for SpecCade v1 specs. This schema is intentionally conservative and may not express all Rust-side validation rules; for authoritative validation use `speccade validate`.",
  "type": "object",
  "additionalProperties": false,
  "required": ["spec_version", "asset_id", "asset_type", "license", "seed", "outputs"],
  "properties": {
    "spec_version": {
      "type": "integer",
      "const": 1,
      "description": "SpecCade schema version (v1)."
    },
    "asset_id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_-]{2,63}$",
      "description": "Stable identifier. Must match `[a-z][a-z0-9_-]{2,63}`."
    },
    "asset_type": {
      "type": "string",
      "enum": ["audio", "music", "texture", "static_mesh", "skeletal_mesh", "skeletal_animation"],
      "description": "Asset type (used to select compatible recipe kinds)."
    },
    "license": {
      "type": "string",
      "minLength": 1,
      "description": "License identifier (SPDX recommended, e.g. `CC0-1.0`)."
    },
    "seed": {
      "type": "integer",
      "minimum": 0,
      "maximum": 4294967295,
      "description": "Deterministic RNG seed (u32)."
    },
    "outputs": {
      "type": "array",
      "minItems": 1,
      "description": "Declared output artifacts. Generation currently writes `primary` outputs (and `packed` outputs for `texture.packed_v1`).",
      "items": { "$ref": "#/definitions/output_spec" }
    },
    "description": {
      "type": "string",
      "description": "Human-readable description."
    },
    "style_tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Semantic tags for filtering/search."
    },
    "engine_targets": {
      "type": "array",
      "items": { "type": "string", "enum": ["godot", "unity", "unreal"] },
      "description": "Target engines."
    },
    "migration_notes": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Informational notes produced by `speccade migrate`."
    },
    "variants": {
      "type": "array",
      "items": { "$ref": "#/definitions/variant_spec" },
      "description": "Reserved for future variant-expansion workflows."
    },
    "recipe": { "$ref": "#/definitions/recipe" }
  },
  "definitions": {
    "variant_spec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["variant_id", "seed_offset"],
      "properties": {
        "variant_id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_-]*$",
          "description": "Variant identifier."
        },
        "seed_offset": {
          "type": "integer",
          "minimum": 0,
          "maximum": 4294967295,
          "description": "Reserved numeric seed offset."
        }
      }
    },
    "recipe": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "params"],
      "properties": {
        "kind": {
          "type": "string",
          "enum": [
            "audio_v1",
            "music.tracker_song_v1",
            "music.tracker_song_compose_v1",
            "texture.material_v1",
            "texture.normal_v1",
            "texture.packed_v1",
            "texture.graph_v1",
            "static_mesh.blender_primitives_v1",
            "skeletal_mesh.blender_rigged_mesh_v1",
            "skeletal_animation.blender_clip_v1"
          ],
          "description": "Recipe kind identifier."
        },
        "params": {
          "type": "object",
          "description": "Backend-specific parameters (validated by Rust)."
        }
      }
    },
    "output_spec": {
      "oneOf": [
        { "$ref": "#/definitions/output_spec_non_packed" },
        { "$ref": "#/definitions/output_spec_packed" }
      ]
    },
    "output_spec_non_packed": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "format", "path"],
      "properties": {
        "kind": {
          "type": "string",
          "enum": ["primary"]
        },
        "format": {
          "type": "string",
          "enum": ["wav", "xm", "it", "png", "glb", "gltf", "json"]
        },
        "path": { "$ref": "#/definitions/output_path" },
        "source": {
          "type": "string",
          "description": "Optional output binding to a named node/map (used by texture.graph_v1)."
        },
        "channels": false
      }
    },
    "output_spec_packed": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "format", "path", "channels"],
      "properties": {
        "kind": { "const": "packed" },
        "format": { "const": "png" },
        "path": { "$ref": "#/definitions/output_path" },
        "channels": { "$ref": "#/definitions/packed_channels" }
      }
    },
    "output_path": {
      "type": "string",
      "pattern": "^(?!.*\\.\\.)[^/\\\\:*?\"<>|]+(/[^/\\\\:*?\"<>|]+)*$",
      "description": "Relative output path (no `..`, no backslashes)."
    },
    "packed_channels": {
      "type": "object",
      "additionalProperties": false,
      "required": ["r", "g", "b"],
      "properties": {
        "r": { "$ref": "#/definitions/channel_source" },
        "g": { "$ref": "#/definitions/channel_source" },
        "b": { "$ref": "#/definitions/channel_source" },
        "a": { "$ref": "#/definitions/channel_source" }
      }
    },
    "channel_source": {
      "oneOf": [
        { "type": "string", "description": "Map key reference." },
        {
          "type": "object",
          "additionalProperties": false,
          "required": ["key"],
          "properties": {
            "key": { "type": "string" },
            "component": { "$ref": "#/definitions/color_component" },
            "invert": { "type": "boolean", "default": false }
          },
          "description": "Extended map reference."
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": ["constant"],
          "properties": {
            "constant": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
          },
          "description": "Constant fill value."
        }
      ]
    },
    "color_component": {
      "type": "string",
      "enum": ["r", "g", "b", "a", "luminance"]
    }
  }
}
